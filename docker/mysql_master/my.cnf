# Copyright (c) 2014, 2016, Oracle and/or its affiliates. All rights reserved.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA

#
# The MySQL  Server configuration file.
#
# For explanations see
# http://dev.mysql.com/doc/mysql/en/server-system-variables.html

[mysqld]
pid-file	= /var/run/mysqld/mysqld.pid
socket		= /var/run/mysqld/mysqld.sock
datadir		= /var/lib/mysql
#log-error	= /var/lib/mysql/error.log

# By default we only accept connections from localhost
#bind-address	= 127.0.0.1
# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0
skip-name-resolve
##主配置
server_id=1
log_bin=bin
sync_binlog=1
innodb_flush_log_at_trx_commit = 1

#开启GTID 
gtid_mode = on 
enforce_gtid_consistency = 1 
log_slave_updates = 1

##不需要同步的库
binlog-ignore-db=information_schema
binlog-ignore-db=performance_schema
binlog-ignore-db=sys
binlog-ignore-db=mysql
#binlog-do-db=db1

##忽略大小写
lower_case_table_names=1

#最大连接数
max_connections = 2000

#慢日志
slow_query_log = ON
slow_query_log_file = slow-log.log
long_query_time = 1 

open_files_limit = 65535
#default-storage-engine=INNODB
#character-set-server=utf8
#collation-server=utf8_general_ci

#开启查询缓存
explicit_defaults_for_timestamp=true

#key_buffer=384M   
table_open_cache=512   
sort_buffer_size=2M  
read_buffer_size=2M 
join_buffer_size=2M   
read_rnd_buffer_size=2M
query_cache_size=40M

##更具CPU合数设置
thread_concurrency = 2

# 二进制日志自动删除/过期的天数。默认值为 0,表示不自动删除。
expire_logs_days=7

#跳过主从复制中遇到的所有错误或指定类型的错误,避免 slave 端复制中断。 
#如:1062 错误是指一些主键重复,1032 错误是因为主从数据库数据不一致
slave_skip_errors=1062

#作为从服务器时的中继日志
relay_log=mysql-relay-bin

#log_slave_updates 表示 slave 将复制事件写进自己的二进制日志
log_slave_updates=1

#主键自增规则，避免主从同步ID重复的问题
auto_increment_increment=2  # 自增因子（每次加2）
auto_increment_offset=1     # 自增偏移（从1开始），单数



[mysqld]
port = 3305
socket		= /tmp/mysql.sock
datadir = /www/server/data
default_storage_engine = InnoDB
performance_schema_max_table_instances = 400
table_definition_cache = 400
skip-external-locking
key_buffer_size = 128M
max_allowed_packet = 100G
table_open_cache = 512
sort_buffer_size = 2M
net_buffer_length = 4K
read_buffer_size = 2M
read_rnd_buffer_size = 256K
myisam_sort_buffer_size = 32M
thread_cache_size = 64
query_cache_size = 64M
tmp_table_size = 64M
sql-mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES

explicit_defaults_for_timestamp = true
#skip-name-resolve
max_connections = 500
max_connect_errors = 100
open_files_limit = 65535

log-bin=mysql-bin
binlog_format=mixed
server-id = 1
expire_logs_days = 10
slow_query_log=1
slow-query-log-file=/www/server/data/mysql-slow.log
long_query_time=3
#log_queries_not_using_indexes=on
early-plugin-load = ""


#innodb_data_home_dir = /www/server/data
#innodb_data_file_path = ibdata1:10M:autoextend
#innodb_log_group_home_dir = /www/server/data
innodb_buffer_pool_size = 512M
innodb_log_file_size = 256M
innodb_log_buffer_size = 64M
innodb_flush_log_at_trx_commit = 1
innodb_lock_wait_timeout = 50
innodb_max_dirty_pages_pct = 90
innodb_read_io_threads = 4
innodb_write_io_threads = 4

[mysqldump]
quick
max_allowed_packet = 500M

[mysql]
no-auto-rehash

[myisamchk]
key_buffer_size = 128M
sort_buffer_size = 2M
read_buffer = 2M
write_buffer = 2M
